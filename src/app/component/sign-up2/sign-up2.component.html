<form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="registration-form">
  <label for="userName">Nom d'utilisateur</label>
  <input
    formControlName="username"
    type="text"
    id="userName"
    class="input-field"
    required
  />
  <!-- Error message for username -->
  @if (userForm.get('username')?.invalid && userForm.get('username')?.touched) {
    <div class="error-msg">
      @if (userForm.get('username')?.errors?.['required']) {
        <div>Le nom d'utilisateur est requis.</div>
      }
      @if (userForm.get('username')?.errors?.['minlength']) {
        <div>Le nom d'utilisateur doit avoir au moins 4 caractères.</div>
      }
    </div>
  }

  <!-- Address fields grouped in a FormGroup -->
  <div formGroupName="address">
    <label for="street">Rue</label>
    <input
      formControlName="street"
      type="text"
      id="street"
      class="input-field"
      required
    />
    <!-- Error message for street -->
    @if (userForm.get('address.street')?.invalid && userForm.get('address.street')?.touched) {
      <div class="error-msg">
        @if (userForm.get('address.street')?.errors?.['required']) {
          <div>La rue est requise.</div>
        }
      </div>
    }

    <label for="city">Ville</label>
    <input
      formControlName="city"
      type="text"
      id="city"
      class="input-field"
      required
    />
    <!-- Error message for city -->
    @if (userForm.get('address.city')?.invalid && userForm.get('address.city')?.touched) {
      <div class="error-msg">
        @if (userForm.get('address.city')?.errors?.['required']) {
          <div>La ville est requise.</div>
        }
      </div>
    }

    <label for="zipCode">Code postal</label>
    <input
      formControlName="zipCode"
      type="text"
      id="zipCode"
      class="input-field"
      required
    />
    <!-- Error message for zipCode -->
    @if (userForm.get('address.zipCode')?.invalid && userForm.get('address.zipCode')?.touched) {
      <div class="error-msg">
        @if (userForm.get('address.zipCode')?.errors?.['required']) {
          <div>Le code postal est requis.</div>
        }
      </div>
    }
  </div>

  <!-- Credentials FormGroup for email and password -->
  <div formGroupName="credentials">
    <label for="email">Email</label>
    <input
      formControlName="email"
      type="email"
      id="email"
      class="input-field"
      required
    />
    <!-- Error message for email -->
    @if (userForm.get('credentials.email')?.invalid && userForm.get('credentials.email')?.touched) {
      <div class="error-msg">
        @if (userForm.get('credentials.email')?.errors?.['required']) {
          <div>L'email est requis.</div>
        }
        @if (userForm.get('credentials.email')?.errors?.['email']) {
          <div>L'email n'est pas valide.</div>
        }
      </div>
    }

    <label for="password">Mot de passe</label>
    <input
      formControlName="password"
      type="password"
      id="password"
      class="input-field"
      required
    />
    <!-- Error message for password -->
    @if (userForm.get('credentials.password')?.invalid && userForm.get('credentials.password')?.touched) {
      <div class="error-msg">
        @if (userForm.get('credentials.password')?.errors?.['required']) {
          <div>Le mot de passe est requis.</div>
        }
      </div>
    }
  </div>

  <button type="submit" [disabled]="!userForm.valid" class="submit-btn">
    S'inscrire
  </button>
</form>

<!-- Display user information after form is valid -->
@if (userForm.valid) {
  <div>
    <h3>Utilisateur créé :</h3>
    <p>Nom d'utilisateur : {{ userForm.value.username }}</p>
    <p>Email : {{ userForm.value.credentials.email }}</p>
    <p>Mot de passe : {{ userForm.value.credentials.password }}</p>
    <p>Ville : {{ userForm.value.address.city }}</p>
    <p>Rue : {{ userForm.value.address.street }}</p>
    <p>Code postal : {{ userForm.value.address.zipCode }}</p>
  </div>
}
